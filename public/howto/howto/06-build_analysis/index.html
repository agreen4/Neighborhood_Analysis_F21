<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.2.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nelson Bighetti" />

  
  
  
    
  
  <meta name="description" content="This brief tutorial takes you through the basics of a “real world” analytic workflow. In this case, the workflow is built around conducting an independent analysis of the Protect Chicago Plus program that enhances SARS-CoV-19 Vaccination availability and outreach in communities in which uptake is low and infections and deaths are high." />

  
  <link rel="alternate" hreflang="en-us" href="/howto/howto/06-build_analysis/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Regular:300,400,500%7CBiryani:400%7CAbril+Fatface%7CCutive+Mono%7CJosefin+Slab:300,400,600,700%7COpen+Sans:400,600,700,800%7CRaleway:300,400,500,600&display=swap">
      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.7543bf421dc036ae8fbee9a5b74f4658.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="/howto/howto/06-build_analysis/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@@urbprof" />
    <meta property="twitter:creator" content="@@urbprof" />
  
  <meta property="og:site_name" content="Neighborhood Analysis" />
  <meta property="og:url" content="/howto/howto/06-build_analysis/" />
  <meta property="og:title" content="Develop an Analysis | Neighborhood Analysis" />
  <meta property="og:description" content="This brief tutorial takes you through the basics of a “real world” analytic workflow. In this case, the workflow is built around conducting an independent analysis of the Protect Chicago Plus program that enhances SARS-CoV-19 Vaccination availability and outreach in communities in which uptake is low and infections and deaths are high." /><meta property="og:image" content="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_2.png" />
    <meta property="twitter:image" content="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_2.png" /><meta property="og:locale" content="en-us" />
  
    
    
  

  



  

  

  





  <title>Develop an Analysis | Neighborhood Analysis</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="19d15a11365fba2a21e8eaf9ef232447" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.b8153d4570dcbb34350a2a846dba8c03.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Neighborhood Analysis</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Neighborhood Analysis</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/syllabus"><span>Syllabus</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/schedule"><span>Schedule</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/assignments"><span>Assignments</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/howto"><span>How To</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource"><span>Resources</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/howto/">How To</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/howto/howto/00-get_started/">Get Started</a>
      </li>

      
      <li >
        <a href="/howto/howto/01-install-r/">Install R &#43; RStudio</a>
      </li>

      
      <li >
        <a href="/howto/howto/02-github/">Set Up Github</a>
      </li>

      
      <li >
        <a href="/howto/howto/03-link_github/">Link GitHub and R</a>
      </li>

      
      <li >
        <a href="/howto/howto/05-build_website/">Build a Website</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/howto/howto/04-basic_commands/">Code</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/howto/howto/04-basic_commands/">First Commands</a>
      </li>

      
      <li class="active">
        <a href="/howto/howto/06-build_analysis/">Develop an Analysis</a>
      </li>

      
      <li >
        <a href="/howto/howto/07-customize_chunks/">Customize Code Chunks</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      

    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Develop an Analysis</h1>

          <div class="article-style">
            

<div id="TOC">

</div>

<p>This brief tutorial takes you through the basics of a “real world” analytic workflow. In this case, the workflow is built around conducting an independent analysis of the <a href="https://www.chicago.gov/city/en/sites/covid-19/home/protect-chicago.html">Protect Chicago Plus</a> program that enhances SARS-CoV-19 Vaccination availability and outreach in communities in which uptake is low and infections and deaths are high.</p>
<p>We’ve examined maps that help to visualize the disparities in where COVID cases are and where vaccinations are more prevalent:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">As of February 17, 2021, Chicago is reporting 95,321 people fully vaccinated: 3.4% of the population.<br><br>Who is dying:           Who is vaccinated: <a href="https://t.co/LZt6OPYgiN">pic.twitter.com/LZt6OPYgiN</a></p>&mdash; ChiVaxBot (@ChiVaxBot) <a href="https://twitter.com/ChiVaxBot/status/1362220407189864450?ref_src=twsrc%5Etfw">February 18, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>The initial goal of our analysis will be to verify that the City has designated those community areas for Protect Chicago Plus with high levels of need. From there, we will also explore some of the demographic correlates associated with these neighborhoods to think about further questions that may emerge.</p>
<p>What we’re doing here is loosely a validation of existing policy targeting. From there we can think about how we might use questions that emerge from our validation for further exploration and explanation.</p>
<div id="getting-set-up" class="section level1">
<h1>Getting Set Up</h1>
<p>As usual, we’ll start by loading some packages.</p>
<pre class="r"><code>library(ggplot2)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ tibble  3.0.4     ✓ dplyr   1.0.2
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.0
## ✓ purrr   0.3.4</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(RSocrata)</code></pre>
<p>We’ve spent time with <code>ggplot2</code> and <code>tidyverse</code> prior but not <code>RSocrata</code>. <code>RSocrata</code> is an R interface for <a href="https://www.tylertech.com/products/socrata">Socrata</a>, which is a data platform designed to host public-facing open data (and which is used by many local governments).</p>
<p>In this case, we’ll use RSocrata to load data for City of Chicago’s datasets on <a href="https://data.cityofchicago.org/Health-Human-Services/COVID-19-Cases-Tests-and-Deaths-by-ZIP-Code/yhhz-zm2v">COVID Cases and Deaths</a></p>
<pre class="r"><code>cdph&lt;-RSocrata::read.socrata(&quot;https://data.cityofchicago.org/resource/yhhz-zm2v.json&quot;)</code></pre>
</div>
<div id="exploratory-plotting" class="section level1">
<h1>Exploratory Plotting</h1>
<p>The data on COVID case positivity contain multiple observations for each ZIP code (one per week). We can use <code>geom_path()</code> to create line charts that chart the positivity rate over time:</p>
<pre class="r"><code>cdph %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), group = zip_code))+geom_path()</code></pre>
<pre><code>## Warning: Removed 187 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Who - a little messy, but we can already see some general trends regarding case positivity. THere are two main “humps” where overall case rates go up, one in summer, and one in fall. At the same time, we can see that there’s some spread - some ZIP codes have much higher peaks and do not see rates return as low as others.</p>
<p>The primary question at this point is, do those ZIP codes with higher peaks and continued elevated rates correspond with the Protect Chicago Plus designation?</p>
</div>
<div id="identify-protect-chicago-plus-zip-codes" class="section level1">
<h1>Identify Protect Chicago Plus ZIP Codes</h1>
<p>Documentation from Protect Chicago Plus lists the specific Chicago community areas where enhanced outreach and vaccinations will take place. Here’s a Community Area map for reference with Protect Chicago Plus areas highlighted in blue:</p>
<p><img src="https://www.chicago.gov/content/dam/city/sites/covid-19-vaccine/images/ProtectChicagoPlus_Map.png" />
Community Areas are a Chicago-specific geography. The data we downloaded on case positivity is at the ZIP code level. How do we reconcile these two things? We could be fancy and use some spatial methods to find the overlap between the selcted community areas and zip codes, but let’s do this manually for now using visual inspection.</p>
<p>Here’s a <a href="https://www.chicago.gov/content/dam/city/sites/covid/reports/2020-04-24/ChicagoCommunityAreaandZipcodeMap.pdf">map from City of Chicago</a> that overlays Community Areas and ZIP Codes.</p>
<p>We can start eyeballing which ZIP codes overlap which Community Areas. Here’s a rough list of the overlap:</p>
<ul>
<li>Austin - 60707, 60639, 60644, 60651</li>
<li>Archer Heights - 60632</li>
<li>Back of the Yards (New City) - 60609</li>
<li>Belmont Cragin - 60634, 60639, 60641</li>
<li>Chicago Lawn - 60629</li>
<li>Englewood - 60621</li>
<li>Gage Park - 60629, 60632</li>
<li>Humboldt Park - 60612, 60624, 60651</li>
<li>Little Village - 60608</li>
<li>North Lawndale - 60623</li>
<li>Montclare - 60707, 60634</li>
<li>Roseland - 60628</li>
<li>South Deering - 60617</li>
<li>Washington Heights - 60620, 60643</li>
<li>West Englewood - 60636</li>
</ul>
<p>Our visual inspection leaves us with a list of the ZIP codes which are (roughly) targeted for Protect Chicago. There is not perfect correspondence, and some of the residents of the ZIP codes will not be targeted. However, the rough correspondence should help us understand some general patterns that allow us to compare case positivity between designated and undesignated ZIP codes.</p>
<p>Let’s create a new categorical variable in our CDPH data called Targeted, and label those ZIP codes that are part of our list “Protect Chicago” and all other ZIP codes “Other ZIP Code”:</p>
<pre class="r"><code>cdph&lt;-cdph %&gt;% mutate(Targeted = case_when(zip_code %in% c(
  &quot;60608&quot;, 
  &quot;60609&quot;, 
  &quot;60612&quot;, 
  &quot;60617&quot;, 
  &quot;60620&quot;, 
  &quot;60621&quot;, 
  &quot;60623&quot;, 
  &quot;60624&quot;, 
  &quot;60628&quot;, 
  &quot;60629&quot;, 
  &quot;60632&quot;, 
  &quot;60634&quot;, 
  &quot;60636&quot;, 
  &quot;60639&quot;, 
  &quot;60641&quot;, 
  &quot;60643&quot;, 
  &quot;60644&quot;, 
  &quot;60651&quot;, 
  &quot;60707&quot;) ~ &quot;Protect Chicago&quot;,
  TRUE ~ &quot;Other ZIP Code&quot;))</code></pre>
<p><code>case_when()</code> is a useful tool for conditionally recoding values. Here we are telling it when a value in the zip_code column corresponds to the list of ZIP codes given, we’ll label those rows “Protect Chicago”. All other rows will be labelled “Other ZIP Code”. As a reminder, we use a <code>mutate()</code> statement to create a new variable.</p>
<p>Now we can re-visit the previous plot, but this time, let’s color each of the zip codes by whether they are targeted under Protect Chicago or not:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), colour = Targeted))+geom_path()</code></pre>
<pre><code>## Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>It looks like there may be a pattern, but it can be a bit hard to see due to <em>overplotting</em>. Let’s change the alpha (transparency) on our plot geometry to see what’s going on under all those lines:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), colour = Targeted))+geom_path(alpha=.2)</code></pre>
<pre><code>## Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>And let’s also add a statistical summary line for each series. By default GGPlot uses a <a href="http://r-statistics.co/Loess-Regression-With-R.html">loess smoothed</a> line:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), colour = Targeted))+
  geom_path(alpha=.2)+
  stat_smooth(se=FALSE)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 133 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>In the above code, I also removed the removed the error shading (<code>se=FALSE</code>) for visual simplicity.</p>
<p>This is looking pretty good - we can see some substantial differences in case positivity rates for Protect Chicago ZIP codes versus those that are not targeted. This gives us some confidence that the program’s targeting is appropriate.</p>
<p>We now have results that at face value make sense and help us to feel fairly confident that the program is targeting communities with the highest need. Given that, let’s invest in a clean up our plot by adding sensible labels and scale formats:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), colour = Targeted))+
  geom_path(alpha=.2)+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Case Rate (per 100,000)&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::comma_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 133 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>At this point, we might also consider a plot that does not include the data series but which just visualizes the statistical summaries of the data:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(case_rate_weekly), colour = Targeted))+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Case Rate (per 100,000)&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::comma_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 133 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="covid-deaths" class="section level1">
<h1>COVID Deaths</h1>
<p>We have focused on plotting case positivity. In the past we’ve looked at COVID deaths as another important measure of need. Do the Protect Chicago Plus ZIP codes also have elevated rates of deaths per capita due to COVID? Let’s repeat the same plot for COVID deaths:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(death_rate_weekly), colour = Targeted))+
  geom_path(alpha=.2)+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Death Rate (per 100,000)&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::comma_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>And the plot of the statistical summaries:</p>
<pre class="r"><code>cdph %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=week_end, y=as.numeric(death_rate_weekly), colour = Targeted))+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Death Rate (per 100,000)&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::comma_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Much quicker now that we have a general plot format developed. We now have a good sense of one portion of the rationale for Protect Chicago Plus targeting - We know the program is targeting neighborhoods that tend to have elevated case positivity rates and death rates. But what about the vaccine situation in these same places?</p>
</div>
<div id="covid-vaccination-data" class="section level1">
<h1>COVID Vaccination Data</h1>
<p>Let’s now load City of Chicago data on <a href="https://data.cityofchicago.org/Health-Human-Services/COVID-19-Vaccinations-by-ZIP-Code/553k-3xzc">COVID Vaccination Rates</a></p>
<pre class="r"><code>cdph_vacc&lt;-RSocrata::read.socrata(&quot;https://data.cityofchicago.org/resource/553k-3xzc.json&quot;)</code></pre>
<p>Now that we’ve downloaded vaccination data, we can create the same Targeted variable in these data:</p>
<pre class="r"><code>cdph_vacc&lt;-cdph_vacc %&gt;% mutate(Targeted = case_when(zip_code %in% c(
  &quot;60608&quot;, 
  &quot;60609&quot;, 
  &quot;60612&quot;, 
  &quot;60617&quot;, 
  &quot;60620&quot;, 
  &quot;60621&quot;, 
  &quot;60623&quot;, 
  &quot;60624&quot;, 
  &quot;60628&quot;, 
  &quot;60629&quot;, 
  &quot;60632&quot;, 
  &quot;60634&quot;, 
  &quot;60636&quot;, 
  &quot;60639&quot;, 
  &quot;60641&quot;, 
  &quot;60643&quot;, 
  &quot;60644&quot;, 
  &quot;60651&quot;, 
  &quot;60707&quot;) ~ &quot;Protect Chicago&quot;,
  TRUE ~ &quot;Other ZIP Code&quot;))</code></pre>
<p>Now that we’ve added the Targeted variable, let’s make an initial plot similar to our final plots for COVID cases and deaths</p>
<pre class="r"><code>cdph_vacc %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=date, y=as.numeric(vaccine_series_completed_percent_population), colour = Targeted))+
  geom_path(alpha=.2)+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Vaccination Rate&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::percent_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Ok, probably some clean up or noise in the data - it looks like we’re probably missing data for some zip codes (the straight lines). We could remove, but let’s proceed for now.</p>
<p>Let’s add a summary smoothed line as we’ve done before</p>
<pre class="r"><code>cdph_vacc %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=date, y=as.numeric(vaccine_series_completed_percent_population), colour = Targeted))+
  geom_path(alpha=.2)+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Vaccination Rate&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::percent_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>And let’s plot the summary without the data series:</p>
<pre class="r"><code>cdph_vacc %&gt;% 
  filter(population &gt; 0) %&gt;% 
  ggplot(aes(x=date, y=as.numeric(vaccine_series_completed_percent_population), colour = Targeted))+
  #geom_path(alpha=.2)+
  stat_smooth(se=FALSE)+
  labs(x=&quot;Date&quot;, y=&quot;COVID Vaccination Rate&quot;, colour = &quot;Type&quot;)+
  scale_y_continuous(labels = scales::percent_format())+
  theme_classic()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>If we stop here, we could affirm that Protect Chicago seems to be targeting some of the most acutely impacted zip codes in the city, which is good, since that’s a major targeting principle of the policy!</p>
</div>
<div id="neighborhood-demographics" class="section level1">
<h1>Neighborhood Demographics</h1>
<p>Let’s go a little further. Our list of targeted zip codes might lead us to be curious about the demographics of targeted and not targeted zip codes. I’ve downloaded some American Community Survey data which we can now load (downloading Census data is another tutorial):</p>
<pre class="r"><code>chi_zcta&lt;-read_rds(&quot;06_build_analysis/chi_zcta.rds&quot;)</code></pre>
<p>We’ve loaded data on ZIP Code Tabulation Areas (ZCTAs) which are the Census Bureau’s proxy for US Postal Service ZIP codes.</p>
<p>Let’s add a new column with our Targeted designations:</p>
<pre class="r"><code>chi_zcta &lt;-chi_zcta %&gt;% mutate(Targeted = case_when(GEOID10 %in% c(
  &quot;60608&quot;, 
  &quot;60609&quot;, 
  &quot;60612&quot;, 
  &quot;60617&quot;, 
  &quot;60620&quot;, 
  &quot;60621&quot;, 
  &quot;60623&quot;, 
  &quot;60624&quot;, 
  &quot;60628&quot;, 
  &quot;60629&quot;, 
  &quot;60632&quot;, 
  &quot;60634&quot;, 
  &quot;60636&quot;, 
  &quot;60639&quot;, 
  &quot;60641&quot;, 
  &quot;60643&quot;, 
  &quot;60644&quot;, 
  &quot;60651&quot;, 
  &quot;60707&quot;) ~ &quot;Protect Chicago&quot;,
  TRUE ~ &quot;Other ZIP Code&quot;))</code></pre>
<p>For these data, we could start by plotting, but in this case, let’s produce a summary table. We take the data, group it by whether a ZIP code was targeted or not, and then produce a summary table with the average values for ZIP codes (<code>summarise_at</code> allows you to select the specific variables you wish to summarize and then applies the same summary function to all of them).</p>
<p>Let’s start by summarizing a few race variables:</p>
<pre class="r"><code>chi_zcta %&gt;% group_by(Targeted) %&gt;% summarise_at(vars(PWhite:PForeignborn), mean, na.rm=TRUE)</code></pre>
<pre><code>## # A tibble: 2 x 8
##   Targeted        PWhite PBlack   PAIAN PAsian PNonwhite PLatino PForeignborn
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1 Other ZIP Code   0.602  0.210 0.00346 0.114      0.398   0.150        0.200
## 2 Protect Chicago  0.321  0.484 0.00332 0.0250     0.679   0.346        0.177</code></pre>
<p>Next up, a few income variables:</p>
<pre class="r"><code>chi_zcta %&gt;% group_by(Targeted) %&gt;% summarise_at(vars(Pov, PCI, MHHI, ServOccup, Commute), mean, na.rm=TRUE)</code></pre>
<pre><code>## # A tibble: 2 x 6
##   Targeted          Pov    PCI   MHHI ServOccup Commute
##   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Other ZIP Code  0.157 55445. 78254.     0.153   0.144
## 2 Protect Chicago 0.253 20524. 41210.     0.262   0.206</code></pre>
<p>And finally, let’s summarize some housing characteristics:</p>
<pre class="r"><code>chi_zcta %&gt;% group_by(Targeted) %&gt;% summarise_at(vars(MHV, OCB, RCB, MGR), mean, na.rm=TRUE)</code></pre>
<pre><code>## # A tibble: 2 x 5
##   Targeted            MHV   OCB   RCB   MGR
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Other ZIP Code  337439. 0.284 0.417 1398.
## 2 Protect Chicago 181895. 0.367 0.545  935.</code></pre>
<p>Now might be a good time for some more exploratory plotting, starting with some selected univariate descriptions:</p>
<div id="exploratory-plots-income" class="section level2">
<h2>Exploratory Plots: Income</h2>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=MHHI, fill = Targeted))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=MHHI, colour = Targeted))+geom_boxplot()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="exploratory-plots-poverty" class="section level2">
<h2>Exploratory Plots: Poverty</h2>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=Pov, fill = Targeted))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=Pov, colour = Targeted))+geom_boxplot()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="exploratory-plots-nonwhite-population" class="section level2">
<h2>Exploratory Plots: Nonwhite Population</h2>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=PNonwhite, fill = Targeted))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=PNonwhite, colour = Targeted))+geom_density()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=PNonwhite, colour = Targeted))+geom_boxplot()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="exploratory-plots-workers-in-service-occupation" class="section level2">
<h2>Exploratory Plots Workers in Service Occupation</h2>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=ServOccup, fill = Targeted))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=ServOccup, colour = Targeted))+geom_density()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<pre class="r"><code>chi_zcta %&gt;% ggplot(aes(x=ServOccup, colour = Targeted))+geom_boxplot()</code></pre>
<p><img src="/howto/howto/06-build_analysis_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
</div>
<div id="questions" class="section level1">
<h1>Questions</h1>
<p>What questions do these exploratory plots and tables bring to mind? What other types of information would you want to overlay next in order to explore further?</p>
</div>

          </div>

          



          
        </div>

        <div class="body-footer">
          <p>Last updated on Jan 1, 0001</p>

          



          




          




        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Made with <a href="https://github.com/agreen4/Neighborhood_Analysis_S21" target="_blank" rel="noopener"><i class="fas fa-code-branch"></i></a>, the <a href="https://cran.r-project.org/" target="_blank" rel="noopener"><i class="fab fa-r-project"></i> </a><a href="https://github.com/rstudio/blogdown" target="_blank" rel="noopener">blogdown</a> package, and the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>

    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.7a65735fc5b6f46dc5d485305a645519.js"></script>

    






</body>
</html>
